# CLI Contract: depman

**Branch**: `001-python-tui-depman` | **Date**: 2026-02-23

## Usage

```
depman [flags]
```

`depman` is a TUI application. It takes no subcommands — launching it enters the interactive terminal interface.

## Flags

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--help` | `-h` | bool | false | Show usage help and exit |
| `--version` | `-v` | bool | false | Show version number and exit |

> Future flags (not in v1): `--config <path>`, `--no-color`, `--check` (non-interactive outdated check)

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Normal exit (user pressed `q`) |
| 1 | Fatal error (no Python found, unrecoverable state) |

## Environment Variables

| Variable | Effect |
|----------|--------|
| `VIRTUAL_ENV` | If set, use this virtualenv (highest priority) |
| `PATH` | Used to locate `uv`, `pip`, `python` binaries |
| `HOME` | Used to locate `~/.config/depman/config.toml` |
| `XDG_CONFIG_HOME` | If set, config is at `$XDG_CONFIG_HOME/depman/config.toml` |

## Configuration File

Location: `~/.config/depman/config.toml`

```toml
[package_manager]
preferred = "uv"  # "uv" | "pip" | "pip3" — default: auto-detect

[pypi]
mirror = "https://pypi.org"  # PyPI base URL

[theme]
name = "tokyo-night"  # default theme
```

## Keybinding Contract (TUI)

### Global

| Key | Action |
|-----|--------|
| `q` | Quit application |
| `?` | Toggle help screen |
| `Esc` | Cancel current action / close overlay |
| `/` or `s` | Open PyPI search panel |

### Navigation (all list views)

| Key | Action |
|-----|--------|
| `j` | Move cursor down |
| `k` | Move cursor up |
| `gg` | Jump to first item |
| `G` | Jump to last item |
| `Ctrl+d` | Half-page down |
| `Ctrl+u` | Half-page up |
| `Tab` | Switch active panel |

### Package Actions (dashboard)

| Key | Action |
|-----|--------|
| `a` | Add package (opens search input) |
| `d` or `x` | Remove selected package (with confirmation) |
| `u` | Update selected package |
| `U` | Update all outdated packages |
| `Enter` | Confirm action |

## File Contracts

### Managed: `requirements.txt`

```
# Generated by depman — do not edit manually
package-a==1.2.3
package-b==4.5.6
```

- Full rewrite on every change
- Sorted alphabetically by package name
- One `package==version` per line
- Header comment always present

### Managed: `pyproject.toml` (dependencies section only)

```toml
[project]
dependencies = [
    # Generated by depman
    "package-a==1.2.3",
    "package-b==4.5.6",
]
```

- Only `[project.dependencies]` is modified
- All other sections preserved byte-for-byte
- Sorted alphabetically within dependencies array

## Stdin/Stdout/Stderr

| Stream | Content |
|--------|---------|
| stdin | Keyboard input (TUI mode) |
| stdout | TUI rendering (Bubble Tea alternate screen) |
| stderr | Fatal errors before TUI starts (e.g., "Error: Python not found") |

## External Dependencies

| Dependency | Required | Detected |
|------------|----------|----------|
| `python` or `python3` | Yes | PATH lookup |
| `pip` or `pip3` | Yes (if no `uv`) | PATH lookup |
| `uv` | No (preferred) | PATH lookup |
